name: Generate Download Page

on:
  push:
    branches:
      - main

jobs:
  generate-download-page:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: List files in docs/d and generate index.html
        run: |
          # Create the index.html file
          echo "<!DOCTYPE html>" > index.html
          echo "<html lang='en'>" >> index.html
          echo "<head>" >> index.html
          echo "  <meta charset='UTF-8'>" >> index.html
          echo "  <title>Download Page</title>" >> index.html
          echo "</head>" >> index.html
          echo "<body>" >> index.html
          echo "  <h1>Download Files</h1>" >> index.html
          echo "  <ul>" >> index.html

          # List all files in docs/d/ and create download links
          for file in docs/d/*; do
            # Check if the file is not a directory
            if [ -f "$file" ]; then
              # Add a download link for the file
              filename=$(basename "$file")
              echo "    <li><a href='docs/d/$filename' download>$filename</a></li>" >> index.html
            fi
          done

          echo "  </ul>" >> index.html
          echo "</body>" >> index.html
          echo "</html>" >> index.html

      - name: Commit and push changes
        uses: EndBug/add-and-commit@v7
        with:
          committer_name: 'GitHub Actions'
          author_email: '41898282+github-actions[bot]@users.noreply.github.com'
          message: 'Update download page'